---
import Layout from "../../../layouts/Layout.astro";
import NoteThumbnail from "../../../components/NoteThumbnail.astro";
import { getNotesWithReadTime } from "../../../utils/notes";

export async function getStaticPaths() {
  const allNotesWithReadTime = await getNotesWithReadTime();
  const uniqueTags = [
    ...new Set(allNotesWithReadTime.flatMap((n) => n.note.data.tags || [])),
  ];

  return uniqueTags.map((tag) => {
    const filteredNotes = allNotesWithReadTime.filter(
      (n) => n.note.data.tags && n.note.data.tags.includes(tag),
    );
    return {
      params: { tag },
      props: { notesWithReadTime: filteredNotes },
    };
  });
}

const { tag } = Astro.params;
const { notesWithReadTime } = Astro.props;
---

<Layout title={`Notes tagged #${tag}`}>
  <div class="mb-8">
    <a href="/note" class="text-primary-600 hover:underline mb-4 inline-block"
      >&larr; Back to all notes</a
    >
    <h1 class="text-3xl font-bold text-dark-500">
      Notes tagged <span class="text-primary-600">#{tag}</span>
    </h1>
  </div>

  <div class="grid gap-4">
    {
      notesWithReadTime.map(({ note, readTime }) => (
        <NoteThumbnail note={note} readTime={readTime} />
      ))
    }
  </div>
</Layout>
