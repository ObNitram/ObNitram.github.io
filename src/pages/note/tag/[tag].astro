---
import Layout from "../../../layouts/Layout.astro";
import NoteThumbnail from "../../../components/NoteThumbnail.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allNotes = await getCollection("notes");
  const uniqueTags = [
    ...new Set(
      allNotes.flatMap(
        (note) => note.data.tags || [],
      ),
    ),
  ];

  return uniqueTags.map((tag) => {
    const filteredNotes = allNotes.filter(
      (note) =>
        note.data.tags && note.data.tags.includes(tag),
    );
    return {
      params: { tag },
      props: { notes: filteredNotes },
    };
  });
}

const { tag } = Astro.params;
const { notes } = Astro.props;
---

<Layout title={`Notes tagged #${tag}`}>
  <div class="mb-8">
    <a href="/note" class="text-primary-600 hover:underline mb-4 inline-block"
      >&larr; Back to all notes</a
    >
    <h1 class="text-3xl font-bold text-dark-500">
      Notes tagged <span class="text-primary-600">#{tag}</span>
    </h1>
  </div>

  <div class="grid gap-4">
    {notes.map((note) => <NoteThumbnail note={note} />)}
  </div>
</Layout>
