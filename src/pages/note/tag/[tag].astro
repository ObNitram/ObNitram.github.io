---
import Layout from "../../../layouts/Layout.astro";
import NoteThumbnail from "../../../components/NoteThumbnail.astro";
import type { MarkdownInstance } from "astro";

interface Frontmatter {
  title: string;
  date?: string;
  tags?: string[];
}

export async function getStaticPaths(): Promise<any> {
  const allNotes = Object.values(
    import.meta.glob<MarkdownInstance<Frontmatter>>("../*.md", { eager: true }),
  );
  const uniqueTags = [
    ...new Set(
      allNotes.flatMap(
        (note: MarkdownInstance<Frontmatter>) => note.frontmatter.tags || [],
      ),
    ),
  ];

  return uniqueTags.map((tag: string) => {
    const filteredNotes = allNotes.filter(
      (note: MarkdownInstance<Frontmatter>) =>
        note.frontmatter.tags && note.frontmatter.tags.includes(tag),
    );
    return {
      params: { tag },
      props: { notes: filteredNotes },
    };
  });
}

interface Props {
  notes: MarkdownInstance<Frontmatter>[];
}

const { tag } = Astro.params;
const { notes } = Astro.props as Props;
---

<Layout title={`Notes tagged #${tag}`}>
  <div class="mb-8">
    <a href="/note" class="text-primary-600 hover:underline mb-4 inline-block"
      >&larr; Back to all notes</a
    >
    <h1 class="text-3xl font-bold text-dark-500">
      Notes tagged <span class="text-primary-600">#{tag}</span>
    </h1>
  </div>

  <div class="grid gap-4">
    {notes.map((note) => <NoteThumbnail note={note} />)}
  </div>
</Layout>
