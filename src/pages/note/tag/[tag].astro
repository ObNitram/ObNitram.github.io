---
import Layout from '../../../layouts/Layout.astro';
import type { MarkdownInstance } from 'astro';

interface Frontmatter {
  title: string;
  date?: string;
  tags?: string[];
}

export async function getStaticPaths(): Promise<any> {
  const allNotes = Object.values(import.meta.glob<MarkdownInstance<Frontmatter>>('../*.md', { eager: true }));
  const uniqueTags = [...new Set(allNotes.flatMap((note: MarkdownInstance<Frontmatter>) => note.frontmatter.tags || []))];

  return uniqueTags.map((tag: string) => {
    const filteredNotes = allNotes.filter((note: MarkdownInstance<Frontmatter>) => 
      note.frontmatter.tags && note.frontmatter.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { notes: filteredNotes },
    };
  });
}

interface Props {
  notes: MarkdownInstance<Frontmatter>[];
}

const { tag } = Astro.params;
const { notes } = Astro.props as Props;
---

<Layout title={`Notes tagged #${tag}`}>
  <div class="mb-8">
    <a href="/note" class="text-primary-600 hover:underline mb-4 inline-block">&larr; Back to all notes</a>
    <h1 class="text-3xl font-bold text-dark-500">Notes tagged <span class="text-primary-600">#{tag}</span></h1>
  </div>
  
  <div class="grid gap-4">
    {notes.map((note) => (
      <a href={note.url} class="block bg-white p-6 rounded-lg shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          <h2 class="text-xl font-bold mb-2 text-dark-500">
            {note.frontmatter.title}
          </h2>
          {note.frontmatter.date && <p class="text-sm text-slate-500">{note.frontmatter.date}</p>}
        </div>
        
        {note.frontmatter.tags && (
          <div class="mt-3 flex flex-wrap gap-2">
            {note.frontmatter.tags.map((t: string) => (
              <span class={`px-2 py-0.5 rounded text-xs border ${t === tag ? 'bg-primary-100 text-primary-700 border-primary-200' : 'bg-slate-50 text-slate-600 border-slate-200'}`}>
                #{t}
              </span>
            ))}
          </div>
        )}
      </a>
    ))}
  </div>
</Layout>
