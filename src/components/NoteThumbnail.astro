---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import NoteTag from "./NoteTag.astro";
import { getNoteUrl } from "../utils/notes";

interface Props {
    note: CollectionEntry<"notes">;
    readTime?: string;
    class?: string;
    [key: string]: any;
}

const { note, readTime, class: className, ...rest } = Astro.props;
const { title, date, tags } = note.data;
const url = `/note/${getNoteUrl(note)}`;

const formattedDate = date
    ? new Date(date).toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
      })
    : undefined;
---

<article
    class:list={[
        "note-card relative block bg-white p-6 rounded-lg shadow-sm border border-slate-100 hover:shadow-md transition-shadow",
        className,
    ]}
    {...rest}
>
    <div class="flex justify-between items-start md:items-center">
        <h2 class="text-xl font-bold mb-2 text-dark-500">
            <a
                href={url}
                class="before:absolute before:inset-0 focus:outline-none"
            >
                {title}
            </a>
        </h2>
        <div class="flex flex-col items-end gap-1 ml-2">
            {
                formattedDate && (
                    <p class="text-sm text-slate-500 whitespace-nowrap flex items-center gap-1 leading-none">
                        <Icon
                            name="heroicons-outline:calendar"
                            class="h-4 w-4 mr-1 text-slate-400 shrink-0 align-middle"
                        />
                        {formattedDate}
                    </p>
                )
            }
            {
                readTime && (
                    <p class="text-sm text-slate-400 whitespace-nowrap flex items-center gap-1 leading-none">
                        <Icon
                            name="heroicons-outline:clock"
                            class="h-4 w-4 mr-1 text-slate-300 shrink-0 align-middle"
                        />
                        {readTime}
                    </p>
                )
            }
        </div>
    </div>

    {
        tags && tags.length > 0 && (
            <div class="mt-3 flex flex-wrap gap-2 relative z-10 pointer-events-none">
                {tags.map((tag) => (
                    <span class="pointer-events-auto">
                        <NoteTag tag={tag} />
                    </span>
                ))}
            </div>
        )
    }
</article>
